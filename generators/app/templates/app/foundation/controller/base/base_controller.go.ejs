package basectl

import (
	"github.com/gin-gonic/gin"
	"github.com/rayyone/go-core/helpers/method"
	"<%= appModName %>/app/errcode"
	"<%= appModName %>/app/foundation/container"
	"<%= appModName %>/app/foundation/service/container"
	"<%= appModName %>/app/helpers/response"
)

type BaseController struct {
	Service *containersvc.Service
	Request *container.Request
}

func (ctl *BaseController) BasePrepare(c *gin.Context) {
	ctl.Request = container.InitRequest(c)
}

func (ctl *BaseController) Validate(param interface{}) error {
	err := method.ValidateStruct(param)
	if err != nil {
		_ = ctl.Request.GinCtx.Error(err)
		return err
	}
	return nil
}

func (ctl *BaseController) HasPermissions(permissions ...string) bool {
	if !ctl.Request.HasPermissions(permissions...) {
		response.RespondError(ctl.Request.GinCtx, errcode.Forbidden.New("You are not authorized!"))
		return false
	}
	return true
}
